/* Copyright (c) 2022 Arm Limited
 * Copyright (c) 2022 Hanno Becker
 * Copyright (c) 2023 Amin Abdulrahman, Matthias Kannwischer
 * Copyright (c) The mlkem-native project authors
 * SPDX-License-Identifier: Apache-2.0 OR ISC OR MIT
 */

/* References
 * ==========
 *
 * - [NeonNTT]
 *   Neon NTT: Faster Dilithium, Kyber, and Saber on Cortex-A72 and Apple M1
 *   Becker, Hwang, Kannwischer, Yang, Yang
 *   https://eprint.iacr.org/2021/986
 *
 * - [SLOTHY_Paper]
 *   Fast and Clean: Auditable high-performance assembly via constraint solving
 *   Abdulrahman, Becker, Kannwischer, Klein
 *   https://eprint.iacr.org/2022/1303
 */

/*yaml
  Name: intt_asm
  Description: AArch64 ML-KEM inverse NTT following @[NeonNTT] and @[SLOTHY_Paper]
  Signature: void mlk_intt_asm(int16_t p[256], const int16_t twiddles12345[80], const int16_t twiddles56[384])
  ABI:
    x0:
      type: buffer
      size_bytes: 512
      permissions: read/write
      c_parameter: int16_t p[256]
      description: Input/output polynomial
    x1:
      type: buffer
      size_bytes: 160
      permissions: read-only
      c_parameter: const int16_t twiddles12345[80]
      description: Twiddle factors for layers 1-5
    x2:
      type: buffer
      size_bytes: 768
      permissions: read-only
      c_parameter: const int16_t twiddles56[384]
      description: Twiddle factors for layers 6-7
  Stack:
    bytes: 64
    description: saving callee-saved Neon registers
*/

#include "../../../common.h"
#if defined(MLK_ARITH_BACKEND_AARCH64) &&  !defined(MLK_CONFIG_MULTILEVEL_NO_SHARED)
/* simpasm: header-end */

// Bounds:
// If C is chosen so that |src| < q * C, then |dst| < q * (0.0508 * C + 1/2)

// See mlken/reduce.c and test/test_bounds.py for more details.
.macro mulmodq dst, src, const, idx0, idx1
        // Signed barrett multiplication @[NeonNTT, Section 3.1.2] using
        // round-to-nearest-even-integer approximation. Following loc.cit.,
        // this is functionally the same as a signed Montgomery multiplication
        // with a suitable constant of absolute value < q.
        sqrdmulh t2.8h,      \src\().8h, \const\().h[\idx1\()]
        mul      \dst\().8h, \src\().8h, \const\().h[\idx0\()]
        mls      \dst\().8h, t2.8h,      consts.h[0]
.endm

.macro mulmod dst, src, const, const_twisted
        sqrdmulh t2.8h,      \src\().8h, \const_twisted\().8h
        mul      \dst\().8h, \src\().8h, \const\().8h
        mls      \dst\().8h, t2.8h,      consts.h[0]
.endm

.macro gs_butterfly a, b, root, idx0, idx1
        sub tmp.8h,   \a\().8h, \b\().8h
        add \a\().8h, \a\().8h, \b\().8h
        mulmodq  \b, tmp, \root, \idx0, \idx1
.endm

.macro gs_butterfly_v a, b, root, root_twisted
        sub tmp.8h,   \a\().8h, \b\().8h
        add \a\().8h, \a\().8h, \b\().8h
        mulmod  \b, tmp, \root, \root_twisted
.endm

.macro mul_ninv dst0, dst1, dst2, dst3, src0, src1, src2, src3
        mulmod \dst0, \src0, ninv, ninv_tw
        mulmod \dst1, \src1, ninv, ninv_tw
        mulmod \dst2, \src2, ninv, ninv_tw
        mulmod \dst3, \src3, ninv, ninv_tw
.endm

.macro barrett_reduce a
        sqdmulh t0.8h,    \a\().8h, consts.h[1]
        srshr   t0.8h,    t0.8h,    #11
        mls     \a\().8h, t0.8h,    consts.h[0]
.endm

.macro load_roots_123
        ldr q_root0, [r12345_ptr], #32
        ldr q_root1, [r12345_ptr, #-16]
.endm

.macro load_next_roots_45
        ldr q_root0, [r12345_ptr], #16
.endm

.macro load_next_roots_67
        ldr q_root0,    [r67_ptr], #(6*16)
        ldr q_root0_tw, [r67_ptr, #(-6*16 + 1*16)]
        ldr q_root1,    [r67_ptr, #(-6*16 + 2*16)]
        ldr q_root1_tw, [r67_ptr, #(-6*16 + 3*16)]
        ldr q_root2,    [r67_ptr, #(-6*16 + 4*16)]
        ldr q_root2_tw, [r67_ptr, #(-6*16 + 5*16)]
.endm

.macro transpose4 data
        trn1 t0.4s, \data\()0.4s, \data\()1.4s
        trn2 t1.4s, \data\()0.4s, \data\()1.4s
        trn1 t2.4s, \data\()2.4s, \data\()3.4s
        trn2 t3.4s, \data\()2.4s, \data\()3.4s

        trn2 \data\()2.2d, t0.2d, t2.2d
        trn2 \data\()3.2d, t1.2d, t3.2d
        trn1 \data\()0.2d, t0.2d, t2.2d
        trn1 \data\()1.2d, t1.2d, t3.2d
.endm

.macro transpose_single data_out, data_in
        trn1 \data_out\()0.4s, \data_in\()0.4s, \data_in\()1.4s
        trn2 \data_out\()1.4s, \data_in\()0.4s, \data_in\()1.4s
        trn1 \data_out\()2.4s, \data_in\()2.4s, \data_in\()3.4s
        trn2 \data_out\()3.4s, \data_in\()2.4s, \data_in\()3.4s
.endm

.macro save_vregs
        sub sp, sp, #(16*4)
        stp  d8,  d9, [sp, #16*0]
        stp d10, d11, [sp, #16*1]
        stp d12, d13, [sp, #16*2]
        stp d14, d15, [sp, #16*3]
.endm

.macro restore_vregs
        ldp  d8,  d9, [sp, #16*0]
        ldp d10, d11, [sp, #16*1]
        ldp d12, d13, [sp, #16*2]
        ldp d14, d15, [sp, #16*3]
        add sp, sp, #(16*4)
.endm

.macro push_stack
        save_vregs
.endm

.macro pop_stack
        restore_vregs
.endm

// For comparability reasons, the output range for the coefficients of this
// invNTT code is supposed to match the implementation from PQClean on commit
// ee71d2c823982bfcf54686f3cf1d666f396dc9aa. After the invNTT, the coefficients
// are NOT canonically reduced. The ordering of the coefficients is canonical,
// also matching PQClean.

        in         .req x0
        r12345_ptr .req x1
        r67_ptr    .req x2

        inp     .req x3
        count   .req x4
        wtmp    .req w5

        data0  .req v8
        data1  .req v9
        data2  .req v10
        data3  .req v11
        data4  .req v12
        data5  .req v13
        data6  .req v14
        data7  .req v15

        q_data0  .req q8
        q_data1  .req q9
        q_data2  .req q10
        q_data3  .req q11
        q_data4  .req q12
        q_data5  .req q13
        q_data6  .req q14
        q_data7  .req q15

        root0    .req v0
        root1    .req v1
        root2    .req v2
        root0_tw .req v4
        root1_tw .req v5
        root2_tw .req v6

        consts     .req v7
        q_consts   .req q7

        q_root0    .req q0
        q_root1    .req q1
        q_root2    .req q2
        q_root0_tw .req q4
        q_root1_tw .req q5
        q_root2_tw .req q6

        tmp .req v24
        t0  .req v25
        t1  .req v26
        t2  .req v27
        t3  .req v28

        ninv             .req v29
        ninv_tw          .req v30

        .text
        .global MLK_ASM_NAMESPACE(intt_asm)
        .balign 4
MLK_ASM_FN_SYMBOL(intt_asm)
        push_stack

        // Setup constants
        mov wtmp, #3329
        mov consts.h[0], wtmp
        mov wtmp, #20159
        mov consts.h[1], wtmp
        mov wtmp, #512
        dup ninv.8h, wtmp
        mov wtmp, #5040
        dup ninv_tw.8h, wtmp

        mov inp, in
        mov count, #8

intt_scale_start:

        ldr q_data0, [inp, #(16*0)]
        ldr q_data1, [inp, #(16*1)]
        ldr q_data2, [inp, #(16*2)]
        ldr q_data3, [inp, #(16*3)]

        mul_ninv data0, data1, data2, data3, data0, data1, data2, data3
        // Bounds: Absolute value < q

        str q_data0, [inp], #64
        str q_data1, [inp, #(-64 + 16*1)]
        str q_data2, [inp, #(-64 + 16*2)]
        str q_data3, [inp, #(-64 + 16*3)]

        subs count, count, #1
        cbnz count, intt_scale_start

        mov inp, in
        mov count, #8

        .p2align 2
                                                 // Instructions:    100
                                                 // Expected cycles: 72
                                                 // Expected IPC:    1.39
                                                 //
                                                 // Cycle bound:     72.0
                                                 // IPC bound:       1.39
                                                 //
                                                 // Wall time:     24.59s
                                                 // User time:     24.59s
                                                 //
                                                 // -------------------------- cycle (expected) --------------------------->
                                                 // 0                        25                       50
                                                 // |------------------------|------------------------|---------------------
        ldr q12, [x3, #0]                        // *.......................................................................
        ldr q21, [x3, #16]                       // *.......................................................................
        ldr q30, [x3, #48]                       // .*......................................................................
        ldr q13, [x3, #32]                       // .*......................................................................
        ldr q3, [x3, #64]                        // ...*....................................................................
        ldr q10, [x3, #80]                       // ...*....................................................................
        trn2 v6.4S, v12.4S, v21.4S               // ....*...................................................................
        trn1 v21.4S, v12.4S, v21.4S              // ....*...................................................................
        trn2 v12.4S, v13.4S, v30.4S              // .....*..................................................................
        trn1 v13.4S, v13.4S, v30.4S              // .....*..................................................................
        ldr q9, [x2, #48]                        // ......*.................................................................
        ldr q31, [x2, #80]                       // ......*.................................................................
        trn1 v15.2D, v6.2D, v12.2D               // .......*................................................................
        trn1 v5.2D, v21.2D, v13.2D               // .......*................................................................
        trn2 v21.2D, v21.2D, v13.2D              // ........*...............................................................
        trn2 v25.2D, v6.2D, v12.2D               // ........*...............................................................
        ldr q12, [x2, #32]                       // .........*..............................................................
        sub v30.8H, v5.8H, v15.8H                // .........*..............................................................
        ldr q20, [x2, #64]                       // ..........*.............................................................
        trn1 v6.4S, v3.4S, v10.4S                // ..........*.............................................................
        sqrdmulh v9.8H, v30.8H, v9.8H            // ...........*............................................................
        sub v13.8H, v21.8H, v25.8H               // ...........*............................................................
        sqrdmulh v31.8H, v13.8H, v31.8H          // .............*..........................................................
        add v15.8H, v5.8H, v15.8H                // .............*..........................................................
        add v5.8H, v21.8H, v25.8H                // ..............*.........................................................
        ldr q21, [x3, #112]                      // ..............*.........................................................
        mul v22.8H, v13.8H, v20.8H               // ...............*........................................................
        ldr q13, [x3, #96]                       // ...............*........................................................
        mul v24.8H, v30.8H, v12.8H               // .................*......................................................
        sub v12.8H, v15.8H, v5.8H                // .................*......................................................
        ldr q28, [x2, #16]                       // ..................*.....................................................
        trn2 v30.4S, v3.4S, v10.4S               // ..................*.....................................................
        mls v22.8H, v31.8H, v7.H[0]              // ...................*....................................................
        trn2 v10.4S, v13.4S, v21.4S              // ...................*....................................................
        ldr q19, [x2], #(6*16)                   // ....................*...................................................
        trn1 v3.4S, v13.4S, v21.4S               // ....................*...................................................
        mls v24.8H, v9.8H, v7.H[0]               // .....................*..................................................
        trn1 v9.2D, v30.2D, v10.2D               // .....................*..................................................
        trn1 v31.2D, v6.2D, v3.2D                // ......................*.................................................
        sqrdmulh v27.8H, v12.8H, v28.8H          // .......................*................................................
        ldr q13, [x2, #32]                       // .......................*................................................
        add v25.8H, v15.8H, v5.8H                // ........................*...............................................
        mul v1.8H, v12.8H, v19.8H                // .........................*..............................................
        sub v21.8H, v31.8H, v9.8H                // .........................*..............................................
        sub v20.8H, v24.8H, v22.8H               // ..........................*.............................................
        mul v12.8H, v21.8H, v13.8H               // ...........................*............................................
        trn2 v5.2D, v30.2D, v10.2D               // ............................*...........................................
        ldr q10, [x2, #80]                       // ............................*...........................................
        sqrdmulh v13.8H, v20.8H, v28.8H          // .............................*..........................................
        trn2 v6.2D, v6.2D, v3.2D                 // ..............................*.........................................
        ldr q15, [x2, #48]                       // ...............................*........................................
        mls v1.8H, v27.8H, v7.H[0]               // ...............................*........................................
        sub v3.8H, v6.8H, v5.8H                  // ................................*.......................................
        ldr q30, [x2, #64]                       // ................................*.......................................
        mul v19.8H, v20.8H, v19.8H               // .................................*......................................
        add v20.8H, v24.8H, v22.8H               // ..................................*.....................................
        mls v19.8H, v13.8H, v7.H[0]              // ...................................*....................................
        trn1 v24.4S, v25.4S, v20.4S              // ....................................*...................................
        ldr q13, [x1], #16                       // .....................................*..................................
        sqrdmulh v10.8H, v3.8H, v10.8H           // .....................................*..................................
        trn2 v27.4S, v25.4S, v20.4S              // ......................................*.................................
        sqrdmulh v21.8H, v21.8H, v15.8H          // .......................................*................................
        trn2 v25.4S, v1.4S, v19.4S               // ........................................*...............................
        trn1 v1.4S, v1.4S, v19.4S                // .........................................*..............................
        mul v30.8H, v3.8H, v30.8H                // .........................................*..............................
        trn1 v20.2D, v27.2D, v25.2D              // ..........................................*.............................
        trn1 v15.2D, v24.2D, v1.2D               // ...........................................*............................
        mls v30.8H, v10.8H, v7.H[0]              // ...........................................*............................
        trn2 v25.2D, v27.2D, v25.2D              // ............................................*...........................
        sub v3.8H, v15.8H, v20.8H                // .............................................*..........................
        mls v12.8H, v21.8H, v7.H[0]              // .............................................*..........................
        trn2 v10.2D, v24.2D, v1.2D               // ..............................................*.........................
        mul v2.8H, v3.8H, v13.H[2]               // ...............................................*........................
        add v20.8H, v15.8H, v20.8H               // ...............................................*........................
        sub v15.8H, v10.8H, v25.8H               // ................................................*.......................
        add v24.8H, v10.8H, v25.8H               // .................................................*......................
        sqdmulh v21.8H, v20.8H, v7.H[1]          // .................................................*......................
        add v19.8H, v12.8H, v30.8H               // ..................................................*.....................
        sqdmulh v10.8H, v24.8H, v7.H[1]          // ...................................................*....................
        sqrdmulh v3.8H, v3.8H, v13.H[3]          // .....................................................*..................
        sub v30.8H, v12.8H, v30.8H               // ......................................................*.................
        mul v14.8H, v15.8H, v13.H[4]             // .......................................................*................
        srshr v12.8H, v21.8H, #11                // .......................................................*................
        srshr v21.8H, v10.8H, #11                // .........................................................*..............
        sqrdmulh v10.8H, v15.8H, v13.H[5]        // .........................................................*..............
        mls v20.8H, v12.8H, v7.H[0]              // ...........................................................*............
        mls v24.8H, v21.8H, v7.H[0]              // .............................................................*..........
        add v27.8H, v31.8H, v9.8H                // .............................................................*..........
        add v25.8H, v6.8H, v5.8H                 // ..............................................................*.........
        ldr q29, [x2, #16]                       // ...............................................................*........
        mls v2.8H, v3.8H, v7.H[0]                // ...............................................................*........
        sub v16.8H, v27.8H, v25.8H               // ................................................................*.......
        mls v14.8H, v10.8H, v7.H[0]              // .................................................................*......
        ldr q22, [x2], #(6*16)                   // .................................................................*......
        sqrdmulh v17.8H, v16.8H, v29.8H          // ...................................................................*....
        mul v1.8H, v30.8H, v22.8H                // .....................................................................*..
        sub v23.8H, v20.8H, v24.8H               // .....................................................................*..
        add v12.8H, v20.8H, v24.8H               // ......................................................................*.
        sqrdmulh v18.8H, v23.8H, v13.H[1]        // .......................................................................*
        sub v24.8H, v2.8H, v14.8H                // .......................................................................*

                                                  // -------------------------- cycle (expected) --------------------------->
                                                  // 0                        25                       50
                                                  // |------------------------|------------------------|---------------------
        // ldr q22, [x2], #(6*16)                 // ....................*...................................................
        // ldr q27, [x3, #0]                      // *.......................................................................
        // ldr q15, [x3, #48]                     // .*......................................................................
        // ldr q0, [x3, #16]                      // *.......................................................................
        // ldr q29, [x3, #32]                     // .*......................................................................
        // trn2 v30.4S, v27.4S, v0.4S             // ....*...................................................................
        // ldr q1, [x2, #-48]                     // ......*.................................................................
        // trn2 v24.4S, v29.4S, v15.4S            // .....*..................................................................
        // ldr q20, [x2, #-32]                    // ..........*.............................................................
        // trn1 v11.4S, v27.4S, v0.4S             // ....*...................................................................
        // trn1 v5.4S, v29.4S, v15.4S             // .....*..................................................................
        // trn1 v16.2D, v30.2D, v24.2D            // .......*................................................................
        // ldr q29, [x2, #-80]                    // ..................*.....................................................
        // trn2 v3.2D, v30.2D, v24.2D             // ........*...............................................................
        // trn1 v18.2D, v11.2D, v5.2D             // .......*................................................................
        // trn2 v11.2D, v11.2D, v5.2D             // ........*...............................................................
        // ldr q31, [x2, #-16]                    // ......*.................................................................
        // sub v24.8H, v18.8H, v16.8H             // .........*..............................................................
        // sub v15.8H, v11.8H, v3.8H              // ...........*............................................................
        // add v27.8H, v18.8H, v16.8H             // .............*..........................................................
        // sqrdmulh v1.8H, v24.8H, v1.8H          // ...........*............................................................
        // add v25.8H, v11.8H, v3.8H              // ..............*.........................................................
        // ldr q9, [x2, #-64]                     // .........*..............................................................
        // sqrdmulh v31.8H, v15.8H, v31.8H        // .............*..........................................................
        // mul v5.8H, v15.8H, v20.8H              // ...............*........................................................
        // mul v15.8H, v24.8H, v9.8H              // .................*......................................................
        // mls v5.8H, v31.8H, v7.H[0]             // ...................*....................................................
        // sub v16.8H, v27.8H, v25.8H             // .................*......................................................
        // sqrdmulh v17.8H, v16.8H, v29.8H        // .......................*................................................
        // mls v15.8H, v1.8H, v7.H[0]             // .....................*..................................................
        // sub v30.8H, v15.8H, v5.8H              // ..........................*.............................................
        // add v19.8H, v15.8H, v5.8H              // ..................................*.....................................
        // mul v1.8H, v30.8H, v22.8H              // .................................*......................................
        // add v4.8H, v27.8H, v25.8H              // ........................*...............................................
        // mul v9.8H, v16.8H, v22.8H              // .........................*..............................................
        // trn1 v20.4S, v4.4S, v19.4S             // ....................................*...................................
        // sqrdmulh v21.8H, v30.8H, v29.8H        // .............................*..........................................
        // trn2 v15.4S, v4.4S, v19.4S             // ......................................*.................................
        // ldr q22, [x2], #(6*16)                 // .................................................................*......
        // mls v9.8H, v17.8H, v7.H[0]             // ...............................*........................................
        // mls v1.8H, v21.8H, v7.H[0]             // ...................................*....................................
        // ldr q27, [x3, #64]                     // ...*....................................................................
        // trn2 v30.4S, v9.4S, v1.4S              // ........................................*...............................
        // trn1 v17.4S, v9.4S, v1.4S              // .........................................*..............................
        // trn1 v24.2D, v15.2D, v30.2D            // ..........................................*.............................
        // ldr q13, [x1], #16                     // .....................................*..................................
        // trn1 v5.2D, v20.2D, v17.2D             // ...........................................*............................
        // trn2 v29.2D, v15.2D, v30.2D            // ............................................*...........................
        // add v4.8H, v5.8H, v24.8H               // ...............................................*........................
        // trn2 v23.2D, v20.2D, v17.2D            // ..............................................*.........................
        // ldr q15, [x3, #112]                    // ..............*.........................................................
        // sub v16.8H, v5.8H, v24.8H              // .............................................*..........................
        // sqdmulh v6.8H, v4.8H, v7.H[1]          // .................................................*......................
        // ldr q0, [x3, #80]                      // ...*....................................................................
        // sub v18.8H, v23.8H, v29.8H             // ................................................*.......................
        // mul v2.8H, v16.8H, v13.H[2]            // ...............................................*........................
        // add v26.8H, v23.8H, v29.8H             // .................................................*......................
        // ldr q29, [x3, #96]                     // ...............*........................................................
        // mul v14.8H, v18.8H, v13.H[4]           // .......................................................*................
        // trn2 v30.4S, v27.4S, v0.4S             // ..................*.....................................................
        // ldr q1, [x2, #-48]                     // ...............................*........................................
        // srshr v25.8H, v6.8H, #11               // .......................................................*................
        // sqdmulh v10.8H, v26.8H, v7.H[1]        // ...................................................*....................
        // trn2 v24.4S, v29.4S, v15.4S            // ...................*....................................................
        // ldr q20, [x2, #-32]                    // ................................*.......................................
        // trn1 v11.4S, v27.4S, v0.4S             // ..........*.............................................................
        // sqrdmulh v23.8H, v16.8H, v13.H[3]      // .....................................................*..................
        // trn1 v5.4S, v29.4S, v15.4S             // ....................*...................................................
        // mls v4.8H, v25.8H, v7.H[0]             // ...........................................................*............
        // trn1 v16.2D, v30.2D, v24.2D            // .....................*..................................................
        // ldr q29, [x2, #-80]                    // ...............................................................*........
        // srshr v28.8H, v10.8H, #11              // .........................................................*..............
        // trn2 v3.2D, v30.2D, v24.2D             // ............................*...........................................
        // sqrdmulh v19.8H, v18.8H, v13.H[5]      // .........................................................*..............
        // trn1 v18.2D, v11.2D, v5.2D             // ......................*.................................................
        // trn2 v11.2D, v11.2D, v5.2D             // ..............................*.........................................
        // ldr q31, [x2, #-16]                    // ............................*...........................................
        // mls v26.8H, v28.8H, v7.H[0]            // .............................................................*..........
        // sub v24.8H, v18.8H, v16.8H             // .........................*..............................................
        // sub v15.8H, v11.8H, v3.8H              // ................................*.......................................
        // add v27.8H, v18.8H, v16.8H             // .............................................................*..........
        // sqrdmulh v1.8H, v24.8H, v1.8H          // .......................................*................................
        // add v25.8H, v11.8H, v3.8H              // ..............................................................*.........
        // ldr q9, [x2, #-64]                     // .......................*................................................
        // sqrdmulh v31.8H, v15.8H, v31.8H        // .....................................*..................................
        // add v12.8H, v4.8H, v26.8H              // ......................................................................*.
        // mul v5.8H, v15.8H, v20.8H              // .........................................*..............................
        // mul v15.8H, v24.8H, v9.8H              // ...........................*............................................
        // mls v5.8H, v31.8H, v7.H[0]             // ...........................................*............................
        // sub v16.8H, v27.8H, v25.8H             // ................................................................*.......
        // sqrdmulh v17.8H, v16.8H, v29.8H        // ...................................................................*....
        // mls v15.8H, v1.8H, v7.H[0]             // .............................................*..........................
        // mls v2.8H, v23.8H, v7.H[0]             // ...............................................................*........
        // sub v23.8H, v4.8H, v26.8H              // .....................................................................*..
        // mls v14.8H, v19.8H, v7.H[0]            // .................................................................*......
        // sub v30.8H, v15.8H, v5.8H              // ......................................................*.................
        // add v19.8H, v15.8H, v5.8H              // ..................................................*.....................
        // sqrdmulh v18.8H, v23.8H, v13.H[1]      // .......................................................................*
        // mul v1.8H, v30.8H, v22.8H              // .....................................................................*..
        // sub v24.8H, v2.8H, v14.8H              // .......................................................................*

        sub count, count, #2
intt_layer4567_start:
                                                 // Instructions:    80
                                                 // Expected cycles: 60
                                                 // Expected IPC:    1.33
                                                 //
                                                 // Cycle bound:     60.0
                                                 // IPC bound:       1.33
                                                 //
                                                 // Wall time:     26.37s
                                                 // User time:     26.37s
                                                 //
                                                 // -------------------- cycle (expected) --------------------->
                                                 // 0                        25                       50
                                                 // |------------------------|------------------------|---------
        add v4.8H, v27.8H, v25.8H                // *...........................................................
        mul v9.8H, v16.8H, v22.8H                // *...........................................................
        add v8.8H, v2.8H, v14.8H                 // .l..........................................................
        trn1 v20.4S, v4.4S, v19.4S               // ..*.........................................................
        sqrdmulh v21.8H, v30.8H, v29.8H          // ..*.........................................................
        trn2 v15.4S, v4.4S, v19.4S               // ...*........................................................
        ldr q22, [x2], #(6*16)                   // ....e.......................................................
        sqrdmulh v4.8H, v24.8H, v13.H[1]         // ....l.......................................................
        mls v9.8H, v17.8H, v7.H[0]               // ......*.....................................................
        mls v1.8H, v21.8H, v7.H[0]               // ........*...................................................
        ldr q27, [x3, #128]                      // .........e..................................................
        mul v26.8H, v24.8H, v13.H[0]             // ..........l.................................................
        mls v26.8H, v4.8H, v7.H[0]               // ............l...............................................
        trn2 v30.4S, v9.4S, v1.4S                // .............*..............................................
        mul v0.8H, v23.8H, v13.H[0]              // ..............l.............................................
        trn1 v17.4S, v9.4S, v1.4S                // ..............*.............................................
        trn1 v24.2D, v15.2D, v30.2D              // ...............*............................................
        ldr q13, [x1], #16                       // ...............*............................................
        mls v0.8H, v18.8H, v7.H[0]               // ................l...........................................
        trn1 v5.2D, v20.2D, v17.2D               // ................*...........................................
        trn2 v29.2D, v15.2D, v30.2D              // .................*..........................................
        str q26, [x3, #48]                       // .................l..........................................
        sqdmulh v21.8H, v8.8H, v7.H[1]           // ..................l.........................................
        add v4.8H, v5.8H, v24.8H                 // ..................*.........................................
        trn2 v23.2D, v20.2D, v17.2D              // ...................*........................................
        ldr q15, [x3, #176]                      // ...................e........................................
        sub v16.8H, v5.8H, v24.8H                // ....................*.......................................
        sqdmulh v6.8H, v4.8H, v7.H[1]            // ....................*.......................................
        str q0, [x3, #32]                        // .....................l......................................
        ldr q0, [x3, #144]                       // .....................e......................................
        sub v18.8H, v23.8H, v29.8H               // ......................*.....................................
        mul v2.8H, v16.8H, v13.H[2]              // ......................*.....................................
        add v26.8H, v23.8H, v29.8H               // .......................*....................................
        ldr q29, [x3, #160]                      // .......................e....................................
        srshr v17.8H, v21.8H, #11                // ........................l...................................
        mul v14.8H, v18.8H, v13.H[4]             // ........................*...................................
        trn2 v30.4S, v27.4S, v0.4S               // .........................e..................................
        ldr q1, [x2, #-48]                       // .........................e..................................
        srshr v25.8H, v6.8H, #11                 // ..........................*.................................
        sqdmulh v10.8H, v26.8H, v7.H[1]          // ..........................*.................................
        trn2 v24.4S, v29.4S, v15.4S              // ...........................e................................
        ldr q20, [x2, #-32]                      // ...........................e................................
        trn1 v11.4S, v27.4S, v0.4S               // ............................e...............................
        sqrdmulh v23.8H, v16.8H, v13.H[3]        // ............................*...............................
        trn1 v5.4S, v29.4S, v15.4S               // .............................e..............................
        mls v4.8H, v25.8H, v7.H[0]               // ..............................*.............................
        str q12, [x3], #(64)                     // ..............................l.............................
        trn1 v16.2D, v30.2D, v24.2D              // ...............................e............................
        ldr q29, [x2, #-80]                      // ...............................e............................
        srshr v28.8H, v10.8H, #11                // ................................*...........................
        mls v8.8H, v17.8H, v7.H[0]               // ................................l...........................
        trn2 v3.2D, v30.2D, v24.2D               // .................................e..........................
        sqrdmulh v19.8H, v18.8H, v13.H[5]        // ..................................*.........................
        trn1 v18.2D, v11.2D, v5.2D               // ..................................e.........................
        trn2 v11.2D, v11.2D, v5.2D               // ...................................e........................
        ldr q31, [x2, #-16]                      // ...................................e........................
        mls v26.8H, v28.8H, v7.H[0]              // ....................................*.......................
        sub v24.8H, v18.8H, v16.8H               // ....................................e.......................
        sub v15.8H, v11.8H, v3.8H                // .....................................e......................
        str q8, [x3, #-48]                       // .....................................l......................
        add v27.8H, v18.8H, v16.8H               // ......................................e.....................
        sqrdmulh v1.8H, v24.8H, v1.8H            // ......................................e.....................
        add v25.8H, v11.8H, v3.8H                // .......................................e....................
        ldr q9, [x2, #-64]                       // .......................................e....................
        sqrdmulh v31.8H, v15.8H, v31.8H          // ........................................e...................
        add v12.8H, v4.8H, v26.8H                // .........................................*..................
        mul v5.8H, v15.8H, v20.8H                // ..........................................e.................
        mul v15.8H, v24.8H, v9.8H                // ............................................e...............
        mls v5.8H, v31.8H, v7.H[0]               // ..............................................e.............
        sub v16.8H, v27.8H, v25.8H               // ..............................................e.............
        sqrdmulh v17.8H, v16.8H, v29.8H          // ................................................e...........
        mls v15.8H, v1.8H, v7.H[0]               // ..................................................e.........
        mls v2.8H, v23.8H, v7.H[0]               // ....................................................*.......
        sub v23.8H, v4.8H, v26.8H                // ....................................................*.......
        mls v14.8H, v19.8H, v7.H[0]              // ......................................................*.....
        sub v30.8H, v15.8H, v5.8H                // .......................................................e....
        add v19.8H, v15.8H, v5.8H                // ........................................................e...
        sqrdmulh v18.8H, v23.8H, v13.H[1]        // ........................................................*...
        mul v1.8H, v30.8H, v22.8H                // ..........................................................e.
        sub v24.8H, v2.8H, v14.8H                // ...........................................................*

                                                      // ------------------------------------------------------------------- cycle (expected) -------------------------------------------------------------------->
                                                      // 0                        25                       50                       75                       100                      125                      150
                                                      // |------------------------|------------------------|------------------------|------------------------|------------------------|------------------------|---
        // ldr q8, [x3, #(16*0)]                      // .....e..................................................'........~..................................................'........~............................
        // ldr q9, [x3, #(16*1)]                      // .................e......................................'....................~......................................'....................~................
        // ldr q10, [x3, #(16*2)]                     // ...................e....................................'......................~....................................'......................~..............
        // ldr q11, [x3, #(16*3)]                     // ...............e........................................'..................~........................................'..................~..................
        // trn1 v25.4s, v8.4s, v9.4s                  // ........................e...............................'...........................~...............................'...........................~.........
        // trn2 v26.4s, v8.4s, v9.4s                  // .....................e..................................'........................~..................................'........................~............
        // trn1 v27.4s, v10.4s, v11.4s                // .........................e..............................'............................~..............................'............................~........
        // trn2 v28.4s, v10.4s, v11.4s                // .......................e................................'..........................~................................'..........................~..........
        // trn2 v10.2d, v25.2d, v27.2d                // ...............................e........................'..................................~........................'..................................~..
        // trn2 v11.2d, v26.2d, v28.2d                // .............................e..........................'................................~..........................'................................~....
        // trn1 v8.2d, v25.2d, v27.2d                 // ..............................e.........................'.................................~.........................'.................................~...
        // trn1 v9.2d, v26.2d, v28.2d                 // ...........................e............................'..............................~............................'..............................~......
        // ldr q0,    [x2], #(6*16)                   // e.......................................................'...~.......................................................'...~.................................
        // ldr q4, [x2, #(-6*16 + 1*16)]              // ...........................e............................'..............................~............................'..............................~......
        // ldr q1,    [x2, #(-6*16 + 2*16)]           // ...................................e....................'......................................~....................'.....................................
        // ldr q5, [x2, #(-6*16 + 3*16)]              // .....................e..................................'........................~..................................'........................~............
        // ldr q2,    [x2, #(-6*16 + 4*16)]           // .......................e................................'..........................~................................'..........................~..........
        // ldr q6, [x2, #(-6*16 + 5*16)]              // ...............................e........................'..................................~........................'..................................~..
        // sub v24.8h,   v8.8h, v9.8h                 // ................................e.......................'...................................~.......................'...................................~.
        // add v8.8h, v8.8h, v9.8h                    // ..................................e.....................'.....................................~.....................'.....................................
        // sqrdmulh v27.8h,      v24.8h, v5.8h        // ..................................e.....................'.....................................~.....................'.....................................
        // mul      v9.8h, v24.8h, v1.8h              // ........................................e...............'...........................................~...............'.....................................
        // mls      v9.8h, v27.8h,      v7.h[0]       // ..............................................e.........'.................................................~.........'.....................................
        // sub v24.8h,   v10.8h, v11.8h               // .................................e......................'....................................~......................'.....................................
        // add v10.8h, v10.8h, v11.8h                 // ...................................e....................'......................................~....................'.....................................
        // sqrdmulh v27.8h,      v24.8h, v6.8h        // ....................................e...................'.......................................~...................'.....................................
        // mul      v11.8h, v24.8h, v2.8h             // ......................................e.................'.........................................~.................'.....................................
        // mls      v11.8h, v27.8h,      v7.h[0]      // ..........................................e.............'.............................................~.............'.....................................
        // sub v24.8h,   v8.8h, v10.8h                // ..........................................e.............'.............................................~.............'.....................................
        // add v8.8h, v8.8h, v10.8h                   // ........................................................*...........................................................~.....................................
        // sqrdmulh v27.8h,      v24.8h, v4.8h        // ............................................e...........'...............................................~...........'.....................................
        // mul      v10.8h, v24.8h, v0.8h             // ........................................................*...........................................................~.....................................
        // mls      v10.8h, v27.8h,      v7.h[0]      // ..~.....................................................'.....*.....................................................'.....~...............................
        // sub v24.8h,   v9.8h, v11.8h                // ...................................................e....'......................................................~....'.....................................
        // add v9.8h, v9.8h, v11.8h                   // ....................................................e...'.......................................................~...'.....................................
        // sqrdmulh v27.8h,      v24.8h, v4.8h        // ........................................................'.*.........................................................'.~...................................
        // mul      v11.8h, v24.8h, v0.8h             // ......................................................e.'.........................................................~.'.....................................
        // mls      v11.8h, v27.8h,      v7.h[0]      // ....~...................................................'.......*...................................................'.......~.............................
        // trn1 v25.4s, v8.4s, v9.4s                  // ........................................................'.*.........................................................'.~...................................
        // trn2 v26.4s, v8.4s, v9.4s                  // ........................................................'..*........................................................'..~..................................
        // trn1 v27.4s, v10.4s, v11.4s                // ..........~.............................................'.............*.............................................'.............~.......................
        // trn2 v28.4s, v10.4s, v11.4s                // .........~..............................................'............*..............................................'............~........................
        // trn2 v10.2d, v25.2d, v27.2d                // ...............~........................................'..................*........................................'..................~..................
        // trn2 v11.2d, v26.2d, v28.2d                // .............~..........................................'................*..........................................'................~....................
        // trn1 v8.2d, v25.2d, v27.2d                 // ............~...........................................'...............*...........................................'...............~.....................
        // trn1 v9.2d, v26.2d, v28.2d                 // ...........~............................................'..............*............................................'..............~......................
        // ldr q0, [x1], #16                          // ...........~............................................'..............*............................................'..............~......................
        // sub v24.8h,   v8.8h, v9.8h                 // ................~.......................................'...................*.......................................'...................~.................
        // add v8.8h, v8.8h, v9.8h                    // ..............~.........................................'.................*.........................................'.................~...................
        // sqrdmulh v27.8h,      v24.8h, v0.h[3]      // ........................~...............................'...........................*...............................'...........................~.........
        // mul      v9.8h, v24.8h, v0.h[2]            // ..................~.....................................'.....................*.....................................'.....................~...............
        // mls      v9.8h, v27.8h,      v7.h[0]       // ................................................~.......'...................................................*.......'.....................................
        // sub v24.8h,   v10.8h, v11.8h               // ..................~.....................................'.....................*.....................................'.....................~...............
        // add v10.8h, v10.8h, v11.8h                 // ...................~....................................'......................*....................................'......................~..............
        // sqrdmulh v27.8h,      v24.8h, v0.h[5]      // ..............................~.........................'.................................*.........................'.................................~...
        // mul      v11.8h, v24.8h, v0.h[4]           // ....................~...................................'.......................*...................................'.......................~.............
        // mls      v11.8h, v27.8h,      v7.h[0]      // ..................................................~.....'.....................................................*.....'.....................................
        // sqdmulh v25.8h,    v8.8h, v7.h[1]          // ................~.......................................'...................*.......................................'...................~.................
        // srshr   v25.8h,    v25.8h,    #11          // ......................~.................................'.........................*.................................'.........................~...........
        // mls     v8.8h, v25.8h,    v7.h[0]          // ..........................~.............................'.............................*.............................'.............................~.......
        // sqdmulh v25.8h,    v10.8h, v7.h[1]         // ......................~.................................'.........................*.................................'.........................~...........
        // srshr   v25.8h,    v25.8h,    #11          // ............................~...........................'...............................*...........................'...............................~.....
        // mls     v10.8h, v25.8h,    v7.h[0]         // ................................~.......................'...................................*.......................'...................................~.
        // sub v24.8h,   v8.8h, v10.8h                // ................................................~.......'...................................................*.......'.....................................
        // add v8.8h, v8.8h, v10.8h                   // .....................................~..................'........................................*..................'.....................................
        // sqrdmulh v27.8h,      v24.8h, v0.h[1]      // ....................................................~...'.......................................................*...'.....................................
        // mul      v10.8h, v24.8h, v0.h[0]           // ..........~.............................................'.............~.............................................'.............l.......................
        // mls      v10.8h, v27.8h,      v7.h[0]      // ............~...........................................'...............~...........................................'...............l.....................
        // sub v24.8h,   v9.8h, v11.8h                // .......................................................~'..........................................................*'.....................................
        // add v9.8h, v9.8h, v11.8h                   // ........................................................'~..........................................................'l....................................
        // sqrdmulh v27.8h,      v24.8h, v0.h[1]      // ~.......................................................'...~.......................................................'...l.................................
        // mul      v11.8h, v24.8h, v0.h[0]           // ......~.................................................'.........~.................................................'.........l...........................
        // mls      v11.8h, v27.8h,      v7.h[0]      // ........~...............................................'...........~...............................................'...........l.........................
        // sqdmulh v25.8h,    v9.8h, v7.h[1]          // ..............~.........................................'.................~.........................................'.................l...................
        // srshr   v25.8h,    v25.8h,    #11          // ....................~...................................'.......................~...................................'.......................l.............
        // mls     v9.8h, v25.8h,    v7.h[0]          // ............................~...........................'...............................~...........................'...............................l.....
        // str q8, [x3], #(64)                        // ..........................~.............................'.............................~.............................'.............................l.......
        // str q9, [x3, #(-64 + 16*1)]                // .................................~......................'....................................~......................'....................................l
        // str q10, [x3, #(-64 + 16*2)]               // .................~......................................'....................~......................................'....................l................
        // str q11, [x3, #(-64 + 16*3)]               // .............~..........................................'................~..........................................'................l....................

        subs count, count, 1
        cbnz count, intt_layer4567_start
                                                // Instructions:    60
                                                // Expected cycles: 62
                                                // Expected IPC:    0.97
                                                //
                                                // Cycle bound:     62.0
                                                // IPC bound:       0.97
                                                //
                                                // Wall time:     1.12s
                                                // User time:     1.12s
                                                //
                                                // --------------------- cycle (expected) ---------------------->
                                                // 0                        25                       50
                                                // |------------------------|------------------------|-----------
        sqrdmulh v10.8H, v30.8H, v29.8H         // *.............................................................
        add v4.8H, v27.8H, v25.8H               // *.............................................................
        add v28.8H, v2.8H, v14.8H               // .*............................................................
        str q12, [x3], #(64)                    // .*............................................................
        mul v2.8H, v16.8H, v22.8H               // ..*...........................................................
        trn1 v9.4S, v4.4S, v19.4S               // ..*...........................................................
        trn2 v11.4S, v4.4S, v19.4S              // ...*..........................................................
        ldr q5, [x1], #16                       // ...*..........................................................
        mls v2.8H, v17.8H, v7.H[0]              // ....*.........................................................
        mls v1.8H, v10.8H, v7.H[0]              // ......*.......................................................
        sqrdmulh v8.8H, v24.8H, v13.H[1]        // ........*.....................................................
        mul v20.8H, v24.8H, v13.H[0]            // ..........*...................................................
        trn1 v4.4S, v2.4S, v1.4S                // ...........*..................................................
        sqdmulh v26.8H, v28.8H, v7.H[1]         // ............*.................................................
        trn2 v14.4S, v2.4S, v1.4S               // ............*.................................................
        trn2 v3.2D, v9.2D, v4.2D                // .............*................................................
        mul v27.8H, v23.8H, v13.H[0]            // ..............*...............................................
        trn2 v10.2D, v11.2D, v14.2D             // ..............*...............................................
        trn1 v24.2D, v9.2D, v4.2D               // ...............*..............................................
        add v0.8H, v3.8H, v10.8H                // ................*.............................................
        mls v27.8H, v18.8H, v7.H[0]             // ................*.............................................
        trn1 v30.2D, v11.2D, v14.2D             // .................*............................................
        sub v4.8H, v3.8H, v10.8H                // ..................*...........................................
        sqdmulh v1.8H, v0.8H, v7.H[1]           // ..................*...........................................
        sub v25.8H, v24.8H, v30.8H              // ...................*..........................................
        add v24.8H, v24.8H, v30.8H              // ....................*.........................................
        mul v31.8H, v4.8H, v5.H[4]              // ....................*.........................................
        sqdmulh v9.8H, v24.8H, v7.H[1]          // ......................*.......................................
        srshr v11.8H, v1.8H, #11                // .......................*......................................
        str q27, [x3, #-32]                     // .......................*......................................
        srshr v23.8H, v26.8H, #11               // ........................*.....................................
        sqrdmulh v17.8H, v25.8H, v5.H[3]        // ........................*.....................................
        sqrdmulh v27.8H, v4.8H, v5.H[5]         // ..........................*...................................
        srshr v10.8H, v9.8H, #11                // ...........................*..................................
        mul v22.8H, v25.8H, v5.H[2]             // ............................*.................................
        mls v22.8H, v17.8H, v7.H[0]             // ..............................*...............................
        mls v31.8H, v27.8H, v7.H[0]             // ................................*.............................
        mls v0.8H, v11.8H, v7.H[0]              // ..................................*...........................
        mls v24.8H, v10.8H, v7.H[0]             // ....................................*.........................
        sub v14.8H, v22.8H, v31.8H              // .....................................*........................
        mls v28.8H, v23.8H, v7.H[0]             // ......................................*.......................
        add v18.8H, v22.8H, v31.8H              // ......................................*.......................
        sqdmulh v6.8H, v18.8H, v7.H[1]          // ........................................*.....................
        sub v26.8H, v24.8H, v0.8H               // .........................................*....................
        add v31.8H, v24.8H, v0.8H               // ..........................................*...................
        mul v12.8H, v14.8H, v5.H[0]             // ..........................................*...................
        str q28, [x3, #-48]                     // ...........................................*..................
        str q31, [x3], #(64)                    // ............................................*.................
        sqrdmulh v31.8H, v26.8H, v5.H[1]        // ............................................*.................
        mul v17.8H, v26.8H, v5.H[0]             // ..............................................*...............
        sqrdmulh v22.8H, v14.8H, v5.H[1]        // ................................................*.............
        mls v17.8H, v31.8H, v7.H[0]             // ..................................................*...........
        mls v20.8H, v8.8H, v7.H[0]              // ....................................................*.........
        srshr v8.8H, v6.8H, #11                 // ....................................................*.........
        mls v12.8H, v22.8H, v7.H[0]             // ......................................................*.......
        str q17, [x3, #-32]                     // .......................................................*......
        mls v18.8H, v8.8H, v7.H[0]              // ........................................................*.....
        str q20, [x3, #-80]                     // .........................................................*....
        str q12, [x3, #-16]                     // ...........................................................*..
        str q18, [x3, #-48]                     // .............................................................*

                                                  // --------------------- cycle (expected) ---------------------->
                                                  // 0                        25                       50
                                                  // |------------------------|------------------------|-----------
        // add v4.8H, v27.8H, v25.8H              // *.............................................................
        // mul v9.8H, v16.8H, v22.8H              // ..*...........................................................
        // add v8.8H, v2.8H, v14.8H               // .*............................................................
        // trn1 v20.4S, v4.4S, v19.4S             // ..*...........................................................
        // sqrdmulh v21.8H, v30.8H, v29.8H        // *.............................................................
        // trn2 v15.4S, v4.4S, v19.4S             // ...*..........................................................
        // sqrdmulh v4.8H, v24.8H, v13.H[1]       // ........*.....................................................
        // mls v9.8H, v17.8H, v7.H[0]             // ....*.........................................................
        // mls v1.8H, v21.8H, v7.H[0]             // ......*.......................................................
        // mul v26.8H, v24.8H, v13.H[0]           // ..........*...................................................
        // mls v26.8H, v4.8H, v7.H[0]             // ....................................................*.........
        // trn2 v30.4S, v9.4S, v1.4S              // ............*.................................................
        // mul v0.8H, v23.8H, v13.H[0]            // ..............*...............................................
        // trn1 v17.4S, v9.4S, v1.4S              // ...........*..................................................
        // trn1 v24.2D, v15.2D, v30.2D            // .................*............................................
        // ldr q13, [x1], #16                     // ...*..........................................................
        // mls v0.8H, v18.8H, v7.H[0]             // ................*.............................................
        // trn1 v5.2D, v20.2D, v17.2D             // ...............*..............................................
        // trn2 v29.2D, v15.2D, v30.2D            // ..............*...............................................
        // str q26, [x3, #48]                     // .........................................................*....
        // sqdmulh v21.8H, v8.8H, v7.H[1]         // ............*.................................................
        // add v4.8H, v5.8H, v24.8H               // ....................*.........................................
        // trn2 v23.2D, v20.2D, v17.2D            // .............*................................................
        // sub v16.8H, v5.8H, v24.8H              // ...................*..........................................
        // sqdmulh v6.8H, v4.8H, v7.H[1]          // ......................*.......................................
        // str q0, [x3, #32]                      // .......................*......................................
        // sub v18.8H, v23.8H, v29.8H             // ..................*...........................................
        // mul v2.8H, v16.8H, v13.H[2]            // ............................*.................................
        // add v26.8H, v23.8H, v29.8H             // ................*.............................................
        // srshr v17.8H, v21.8H, #11              // ........................*.....................................
        // mul v14.8H, v18.8H, v13.H[4]           // ....................*.........................................
        // srshr v25.8H, v6.8H, #11               // ...........................*..................................
        // sqdmulh v10.8H, v26.8H, v7.H[1]        // ..................*...........................................
        // sqrdmulh v23.8H, v16.8H, v13.H[3]      // ........................*.....................................
        // mls v4.8H, v25.8H, v7.H[0]             // ....................................*.........................
        // str q12, [x3], #(64)                   // .*............................................................
        // srshr v28.8H, v10.8H, #11              // .......................*......................................
        // mls v8.8H, v17.8H, v7.H[0]             // ......................................*.......................
        // sqrdmulh v19.8H, v18.8H, v13.H[5]      // ..........................*...................................
        // mls v26.8H, v28.8H, v7.H[0]            // ..................................*...........................
        // str q8, [x3, #-48]                     // ...........................................*..................
        // add v12.8H, v4.8H, v26.8H              // ..........................................*...................
        // mls v2.8H, v23.8H, v7.H[0]             // ..............................*...............................
        // sub v23.8H, v4.8H, v26.8H              // .........................................*....................
        // mls v14.8H, v19.8H, v7.H[0]            // ................................*.............................
        // sqrdmulh v18.8H, v23.8H, v13.H[1]      // ............................................*.................
        // sub v24.8H, v2.8H, v14.8H              // .....................................*........................
        // add v8.8H, v2.8H, v14.8H               // ......................................*.......................
        // sqrdmulh v4.8H, v24.8H, v13.H[1]       // ................................................*.............
        // mul v26.8H, v24.8H, v13.H[0]           // ..........................................*...................
        // mls v26.8H, v4.8H, v7.H[0]             // ......................................................*.......
        // mul v0.8H, v23.8H, v13.H[0]            // ..............................................*...............
        // mls v0.8H, v18.8H, v7.H[0]             // ..................................................*...........
        // str q26, [x3, #48]                     // ...........................................................*..
        // sqdmulh v21.8H, v8.8H, v7.H[1]         // ........................................*.....................
        // str q0, [x3, #32]                      // .......................................................*......
        // srshr v17.8H, v21.8H, #11              // ....................................................*.........
        // str q12, [x3], #(64)                   // ............................................*.................
        // mls v8.8H, v17.8H, v7.H[0]             // ........................................................*.....
        // str q8, [x3, #-48]                     // .............................................................*


        // ---------------------------------------------------------------------

        mov count, #4
        load_roots_123

        .p2align 2

                                                // Instructions:    74
                                                // Expected cycles: 65
                                                // Expected IPC:    1.14
                                                //
                                                // Cycle bound:     65.0
                                                // IPC bound:       1.14
                                                //
                                                // Wall time:     1.03s
                                                // User time:     1.03s
                                                //
                                                // ----------------------- cycle (expected) ----------------------->
                                                // 0                        25                       50
                                                // |------------------------|------------------------|--------------
        ldr q28, [x0, #256]                     // *................................................................
        ldr q9, [x0, #320]                      // *................................................................
        ldr q10, [x0, #448]                     // .*...............................................................
        ldr q29, [x0, #384]                     // .*...............................................................
        ldr q16, [x0, #192]                     // ..*..............................................................
        ldr q30, [x0, #128]                     // ..*..............................................................
        ldr q25, [x0, #64]                      // ...*.............................................................
        ldr q20, [x0, #0]                       // ...*.............................................................
        add v13.8H, v28.8H, v9.8H               // ....*............................................................
        sub v8.8H, v28.8H, v9.8H                // ....*............................................................
        add v5.8H, v29.8H, v10.8H               // .....*...........................................................
        sub v6.8H, v29.8H, v10.8H               // .....*...........................................................
        sub v31.8H, v30.8H, v16.8H              // ......*..........................................................
        sqrdmulh v22.8H, v8.8H, v1.H[3]         // ......*..........................................................
        sub v21.8H, v20.8H, v25.8H              // .......*.........................................................
        ldr q19, [x0, #16]                      // .......*.........................................................
        add v16.8H, v30.8H, v16.8H              // ........*........................................................
        sqrdmulh v11.8H, v31.8H, v1.H[1]        // ........*........................................................
        add v24.8H, v20.8H, v25.8H              // .........*.......................................................
        ldr q3, [x0, #144]                      // .........*.......................................................
        sqrdmulh v4.8H, v21.8H, v0.H[7]         // ..........*......................................................
        sub v10.8H, v13.8H, v5.8H               // ..........*......................................................
        sub v2.8H, v24.8H, v16.8H               // ...........*.....................................................
        ldr q12, [x0, #208]                     // ...........*.....................................................
        add v13.8H, v13.8H, v5.8H               // ............*....................................................
        sqrdmulh v5.8H, v6.8H, v1.H[5]          // ............*....................................................
        add v26.8H, v24.8H, v16.8H              // .............*...................................................
        ldr q17, [x0, #80]                      // .............*...................................................
        mul v25.8H, v21.8H, v0.H[6]             // ..............*..................................................
        ldr q24, [x0, #464]                     // ..............*..................................................
        sub v27.8H, v26.8H, v13.8H              // ...............*.................................................
        ldr q20, [x0, #400]                     // ...............*.................................................
        mul v14.8H, v31.8H, v1.H[0]             // ................*................................................
        add v16.8H, v3.8H, v12.8H               // ................*................................................
        add v18.8H, v19.8H, v17.8H              // .................*...............................................
        ldr q30, [x0, #272]                     // .................*...............................................
        mul v28.8H, v8.8H, v1.H[2]              // ..................*..............................................
        add v21.8H, v26.8H, v13.8H              // ..................*..............................................
        sub v15.8H, v18.8H, v16.8H              // ...................*.............................................
        mul v8.8H, v6.8H, v1.H[4]               // ....................*............................................
        str q21, [x0], #(16)                    // ....................*............................................
        add v18.8H, v18.8H, v16.8H              // .....................*...........................................
        mls v25.8H, v4.8H, v7.H[0]              // ......................*..........................................
        mls v8.8H, v5.8H, v7.H[0]               // ........................*........................................
        mls v28.8H, v22.8H, v7.H[0]             // ..........................*......................................
        mls v14.8H, v11.8H, v7.H[0]             // ............................*....................................
        sqrdmulh v9.8H, v10.8H, v0.H[5]         // ..............................*..................................
        sub v21.8H, v28.8H, v8.8H               // ...............................*.................................
        add v31.8H, v28.8H, v8.8H               // ................................*................................
        sqrdmulh v16.8H, v2.8H, v0.H[3]         // ................................*................................
        sub v13.8H, v25.8H, v14.8H              // .................................*...............................
        add v25.8H, v25.8H, v14.8H              // ..................................*..............................
        sqrdmulh v22.8H, v21.8H, v0.H[5]        // ..................................*..............................
        sqrdmulh v26.8H, v13.8H, v0.H[3]        // ....................................*............................
        sub v5.8H, v25.8H, v31.8H               // ....................................*............................
        mul v10.8H, v10.8H, v0.H[4]             // ......................................*..........................
        mul v2.8H, v2.8H, v0.H[2]               // ........................................*........................
        mul v4.8H, v13.8H, v0.H[2]              // ..........................................*......................
        mul v29.8H, v21.8H, v0.H[4]             // ............................................*....................
        mls v10.8H, v9.8H, v7.H[0]              // ..............................................*..................
        mls v2.8H, v16.8H, v7.H[0]              // ................................................*................
        mls v29.8H, v22.8H, v7.H[0]             // ..................................................*..............
        mls v4.8H, v26.8H, v7.H[0]              // ....................................................*............
        add v8.8H, v2.8H, v10.8H                // .....................................................*...........
        sub v2.8H, v2.8H, v10.8H                // ......................................................*..........
        sqrdmulh v26.8H, v27.8H, v0.H[1]        // ......................................................*..........
        str q8, [x0, #112]                      // .......................................................*.........
        mul v8.8H, v27.8H, v0.H[0]              // ........................................................*........
        sub v16.8H, v4.8H, v29.8H               // .........................................................*.......
        add v28.8H, v4.8H, v29.8H               // ..........................................................*......
        sqrdmulh v10.8H, v2.8H, v0.H[1]         // ..........................................................*......
        sqrdmulh v27.8H, v5.8H, v0.H[1]         // ............................................................*....
        mls v8.8H, v26.8H, v7.H[0]              // ..............................................................*..
        sqrdmulh v29.8H, v16.8H, v0.H[1]        // ................................................................*

                                                 // ----------------------- cycle (expected) ----------------------->
                                                 // 0                        25                       50
                                                 // |------------------------|------------------------|--------------
        // ldr q17, [x0, #64]                    // ...*.............................................................
        // ldr q12, [x0, #192]                   // ..*..............................................................
        // ldr q3, [x0, #128]                    // ..*..............................................................
        // ldr q30, [x0, #256]                   // *................................................................
        // add v9.8H, v3.8H, v12.8H              // ........*........................................................
        // ldr q19, [x0, #0]                     // ...*.............................................................
        // add v6.8H, v19.8H, v17.8H             // .........*.......................................................
        // sub v15.8H, v6.8H, v9.8H              // ...........*.....................................................
        // ldr q24, [x0, #448]                   // .*...............................................................
        // add v18.8H, v6.8H, v9.8H              // .............*...................................................
        // ldr q20, [x0, #384]                   // .*...............................................................
        // sub v6.8H, v19.8H, v17.8H             // .......*.........................................................
        // ldr q22, [x0, #320]                   // *................................................................
        // sqrdmulh v11.8H, v6.8H, v0.H[7]       // ..........*......................................................
        // add v13.8H, v20.8H, v24.8H            // .....*...........................................................
        // mul v26.8H, v6.8H, v0.H[6]            // ..............*..................................................
        // add v4.8H, v30.8H, v22.8H             // ....*............................................................
        // sub v31.8H, v4.8H, v13.8H             // ..........*......................................................
        // mls v26.8H, v11.8H, v7.H[0]           // ......................*..........................................
        // add v13.8H, v4.8H, v13.8H             // ............*....................................................
        // sub v28.8H, v18.8H, v13.8H            // ...............*.................................................
        // sub v29.8H, v30.8H, v22.8H            // ....*............................................................
        // ldr q17, [x0, #80]                    // .............*...................................................
        // mul v8.8H, v28.8H, v0.H[0]            // ........................................................*........
        // sub v3.8H, v3.8H, v12.8H              // ......*..........................................................
        // sqrdmulh v21.8H, v28.8H, v0.H[1]      // ......................................................*..........
        // sub v14.8H, v20.8H, v24.8H            // .....*...........................................................
        // mul v16.8H, v3.8H, v1.H[0]            // ................*................................................
        // sqrdmulh v9.8H, v3.8H, v1.H[1]        // ........*........................................................
        // sqrdmulh v4.8H, v31.8H, v0.H[5]       // ..............................*..................................
        // mul v11.8H, v31.8H, v0.H[4]           // ......................................*..........................
        // ldr q12, [x0, #208]                   // ...........*.....................................................
        // ldr q3, [x0, #144]                    // .........*.......................................................
        // mls v16.8H, v9.8H, v7.H[0]            // ............................*....................................
        // sqrdmulh v19.8H, v29.8H, v1.H[3]      // ......*..........................................................
        // mls v11.8H, v4.8H, v7.H[0]            // ..............................................*..................
        // sub v22.8H, v26.8H, v16.8H            // .................................*...............................
        // sqrdmulh v6.8H, v14.8H, v1.H[5]       // ............*....................................................
        // ldr q30, [x0, #272]                   // .................*...............................................
        // mul v4.8H, v22.8H, v0.H[2]            // ..........................................*......................
        // add v25.8H, v26.8H, v16.8H            // ..................................*..............................
        // sqrdmulh v28.8H, v22.8H, v0.H[3]      // ....................................*............................
        // mul v22.8H, v29.8H, v1.H[2]           // ..................*..............................................
        // add v9.8H, v3.8H, v12.8H              // ................*................................................
        // mls v22.8H, v19.8H, v7.H[0]           // ..........................*......................................
        // ldr q19, [x0, #16]                    // .......*.........................................................
        // mul v29.8H, v14.8H, v1.H[4]           // ....................*............................................
        // add v14.8H, v18.8H, v13.8H            // ..................*..............................................
        // mls v29.8H, v6.8H, v7.H[0]            // ........................*........................................
        // str q14, [x0], #(16)                  // ....................*............................................
        // add v6.8H, v19.8H, v17.8H             // .................*...............................................
        // sqrdmulh v13.8H, v15.8H, v0.H[3]      // ................................*................................
        // mul v23.8H, v15.8H, v0.H[2]           // ........................................*........................
        // sub v15.8H, v6.8H, v9.8H              // ...................*.............................................
        // add v31.8H, v22.8H, v29.8H            // ................................*................................
        // mls v23.8H, v13.8H, v7.H[0]           // ................................................*................
        // sub v13.8H, v22.8H, v29.8H            // ...............................*.................................
        // mls v8.8H, v21.8H, v7.H[0]            // ..............................................................*..
        // ldr q24, [x0, #448]                   // ..............*..................................................
        // sqrdmulh v22.8H, v13.8H, v0.H[5]      // ..................................*..............................
        // sub v2.8H, v23.8H, v11.8H             // ......................................................*..........
        // add v16.8H, v23.8H, v11.8H            // .....................................................*...........
        // mul v23.8H, v13.8H, v0.H[4]           // ............................................*....................
        // sub v5.8H, v25.8H, v31.8H             // ....................................*............................
        // mls v4.8H, v28.8H, v7.H[0]            // ....................................................*............
        // str q16, [x0, #112]                   // .......................................................*.........
        // mls v23.8H, v22.8H, v7.H[0]           // ..................................................*..............
        // sqrdmulh v27.8H, v5.8H, v0.H[1]       // ............................................................*....
        // sub v16.8H, v4.8H, v23.8H             // .........................................................*.......
        // add v28.8H, v4.8H, v23.8H             // ..........................................................*......
        // sqrdmulh v10.8H, v2.8H, v0.H[1]       // ..........................................................*......
        // add v18.8H, v6.8H, v9.8H              // .....................*...........................................
        // sqrdmulh v29.8H, v16.8H, v0.H[1]      // ................................................................*
        // ldr q20, [x0, #384]                   // ...............*.................................................

        sub count, count, #2
intt_layer123_start:
                                                // Instructions:    76
                                                // Expected cycles: 72
                                                // Expected IPC:    1.06
                                                //
                                                // Cycle bound:     72.0
                                                // IPC bound:       1.06
                                                //
                                                // Wall time:     24.40s
                                                // User time:     24.40s
                                                //
                                                // -------------------------- cycle (expected) --------------------------->
                                                // 0                        25                       50
                                                // |------------------------|------------------------|---------------------
        sub v6.8H, v19.8H, v17.8H               // *.......................................................................
        str q28, [x0, #176]                     // l.......................................................................
        ldr q22, [x0, #320]                     // .*......................................................................
        mul v23.8H, v2.8H, v0.H[0]              // .l......................................................................
        sqrdmulh v11.8H, v6.8H, v0.H[7]         // ...*....................................................................
        str q8, [x0, #240]                      // ....l...................................................................
        add v13.8H, v20.8H, v24.8H              // .....*..................................................................
        mul v26.8H, v6.8H, v0.H[6]              // .....*..................................................................
        add v4.8H, v30.8H, v22.8H               // ......*.................................................................
        add v6.8H, v25.8H, v31.8H               // .......l................................................................
        mul v14.8H, v16.8H, v0.H[0]             // .......l................................................................
        sub v31.8H, v4.8H, v13.8H               // ........*...............................................................
        mls v26.8H, v11.8H, v7.H[0]             // .........*..............................................................
        add v13.8H, v4.8H, v13.8H               // .........*..............................................................
        str q6, [x0, #48]                       // ..........l.............................................................
        mls v14.8H, v29.8H, v7.H[0]             // ...........l............................................................
        sub v28.8H, v18.8H, v13.8H              // ...........*............................................................
        sub v29.8H, v30.8H, v22.8H              // ............*...........................................................
        ldr q17, [x0, #80]                      // ............e...........................................................
        mul v8.8H, v28.8H, v0.H[0]              // .............*..........................................................
        sub v3.8H, v3.8H, v12.8H                // ..............*.........................................................
        sqrdmulh v21.8H, v28.8H, v0.H[1]        // ...............*........................................................
        str q14, [x0, #432]                     // ................l.......................................................
        sub v14.8H, v20.8H, v24.8H              // ................*.......................................................
        mul v16.8H, v3.8H, v1.H[0]              // .................*......................................................
        sqrdmulh v9.8H, v3.8H, v1.H[1]          // ...................*....................................................
        sqrdmulh v4.8H, v31.8H, v0.H[5]         // .....................*..................................................
        mul v11.8H, v31.8H, v0.H[4]             // .......................*................................................
        ldr q12, [x0, #208]                     // .......................e................................................
        ldr q3, [x0, #144]                      // ........................e...............................................
        mls v16.8H, v9.8H, v7.H[0]              // .........................*..............................................
        sqrdmulh v19.8H, v29.8H, v1.H[3]        // ...........................*............................................
        mls v11.8H, v4.8H, v7.H[0]              // .............................*..........................................
        sub v22.8H, v26.8H, v16.8H              // ..............................*.........................................
        sqrdmulh v6.8H, v14.8H, v1.H[5]         // ...............................*........................................
        ldr q30, [x0, #272]                     // .................................e......................................
        mul v4.8H, v22.8H, v0.H[2]              // .................................*......................................
        add v25.8H, v26.8H, v16.8H              // ...................................*....................................
        sqrdmulh v28.8H, v22.8H, v0.H[3]        // ...................................*....................................
        mul v22.8H, v29.8H, v1.H[2]             // .....................................*..................................
        mls v23.8H, v10.8H, v7.H[0]             // .......................................l................................
        add v9.8H, v3.8H, v12.8H                // .......................................e................................
        mls v22.8H, v19.8H, v7.H[0]             // .........................................*..............................
        ldr q19, [x0, #16]                      // ..........................................e.............................
        mul v29.8H, v14.8H, v1.H[4]             // ...........................................*............................
        add v14.8H, v18.8H, v13.8H              // ...........................................*............................
        str q23, [x0, #368]                     // ............................................l...........................
        mls v29.8H, v6.8H, v7.H[0]              // .............................................*..........................
        str q14, [x0], #(16)                    // .............................................*..........................
        add v6.8H, v19.8H, v17.8H               // ..............................................e.........................
        sqrdmulh v13.8H, v15.8H, v0.H[3]        // ...............................................*........................
        mul v23.8H, v15.8H, v0.H[2]             // .................................................*......................
        sub v15.8H, v6.8H, v9.8H                // .................................................e......................
        add v31.8H, v22.8H, v29.8H              // ..................................................*.....................
        mul v18.8H, v5.8H, v0.H[0]              // ...................................................l....................
        mls v23.8H, v13.8H, v7.H[0]             // .....................................................*..................
        sub v13.8H, v22.8H, v29.8H              // .....................................................*..................
        mls v8.8H, v21.8H, v7.H[0]              // .......................................................*................
        ldr q24, [x0, #448]                     // .......................................................e................
        sqrdmulh v22.8H, v13.8H, v0.H[5]        // .........................................................*..............
        sub v2.8H, v23.8H, v11.8H               // ..........................................................*.............
        add v16.8H, v23.8H, v11.8H              // ...........................................................*............
        mul v23.8H, v13.8H, v0.H[4]             // ...........................................................*............
        sub v5.8H, v25.8H, v31.8H               // ............................................................*...........
        mls v4.8H, v28.8H, v7.H[0]              // .............................................................*..........
        str q16, [x0, #112]                     // .............................................................*..........
        mls v23.8H, v22.8H, v7.H[0]             // ...............................................................*........
        mls v18.8H, v27.8H, v7.H[0]             // .................................................................l......
        sqrdmulh v27.8H, v5.8H, v0.H[1]         // ...................................................................*....
        sub v16.8H, v4.8H, v23.8H               // ....................................................................*...
        add v28.8H, v4.8H, v23.8H               // .....................................................................*..
        sqrdmulh v10.8H, v2.8H, v0.H[1]         // .....................................................................*..
        str q18, [x0, #288]                     // ......................................................................l.
        add v18.8H, v6.8H, v9.8H                // ......................................................................e.
        sqrdmulh v29.8H, v16.8H, v0.H[1]        // .......................................................................*
        ldr q20, [x0, #384]                     // .......................................................................e

                                                      // -------------------------------------------------------------------------------------------- cycle (expected) -------------------------------------------------------------------------------------------->
                                                      // 0                        25                       50                       75                       100                      125                      150                      175                      200
                                                      // |------------------------|------------------------|------------------------|------------------------|------------------------|------------------------|------------------------|------------------------|--
        // ldr q8, [x0, #0]                           // ..............................e.............................'.........................................~.............................'.........................................~............................
        // ldr q9, [x0, #(1*(512/8))]                 // e...........................................................'...........~...........................................................'...........~..........................................................
        // ldr q10, [x0, #(2*(512/8))]                // ............e...............................................'.......................~...............................................'.......................~..............................................
        // ldr q11, [x0, #(3*(512/8))]                // ...........e................................................'......................~................................................'......................~...............................................
        // ldr q12, [x0, #(4*(512/8))]                // .....................e......................................'................................~......................................'................................~.....................................
        // ldr q13, [x0, #(5*(512/8))]                // ............................................................'*......................................................................'~.....................................................................
        // ldr q14, [x0, #(6*(512/8))]                // ...........................................................e'......................................................................~'......................................................................
        // ldr q15, [x0, #(7*(512/8))]                // ...........................................e................'......................................................~................'......................................................~...............
        // sub v24.8h,   v8.8h, v9.8h                 // ............................................................*.......................................................................~......................................................................
        // add v8.8h, v8.8h, v9.8h                    // ..................................e.........................'.............................................~.........................'.............................................~........................
        // sqrdmulh v27.8h,      v24.8h, v0.h[7]      // ............................................................'..*....................................................................'..~...................................................................
        // mul      v9.8h, v24.8h, v0.h[6]            // ............................................................'....*..................................................................'....~.................................................................
        // mls      v9.8h, v27.8h,      v7.h[0]       // ............................................................'........*..............................................................'........~.............................................................
        // sub v24.8h,   v10.8h, v11.8h               // ..~.........................................................'.............*.........................................................'.............~........................................................
        // add v10.8h, v10.8h, v11.8h                 // ...........................e................................'......................................~................................'......................................~...............................
        // sqrdmulh v27.8h,      v24.8h, v1.h[1]      // .......~....................................................'..................*....................................................'..................~...................................................
        // mul      v11.8h, v24.8h, v1.h[0]           // .....~......................................................'................*......................................................'................~.....................................................
        // mls      v11.8h, v27.8h,      v7.h[0]      // .............~..............................................'........................*..............................................'........................~.............................................
        // sub v24.8h,   v12.8h, v13.8h               // ~...........................................................'...........*...........................................................'...........~..........................................................
        // add v12.8h, v12.8h, v13.8h                 // ............................................................'.....*.................................................................'.....~................................................................
        // sqrdmulh v27.8h,      v24.8h, v1.h[3]      // ...............~............................................'..........................*............................................'..........................~...........................................
        // mul      v13.8h, v24.8h, v1.h[2]           // .........................~..................................'....................................*..................................'....................................~.................................
        // mls      v13.8h, v27.8h,      v7.h[0]      // .............................~..............................'........................................*..............................'........................................~.............................
        // sub v24.8h,   v14.8h, v15.8h               // ....~.......................................................'...............*.......................................................'...............~......................................................
        // add v14.8h, v14.8h, v15.8h                 // ............................................................'....*..................................................................'....~.................................................................
        // sqrdmulh v27.8h,      v24.8h, v1.h[5]      // ...................~........................................'..............................*........................................'..............................~.......................................
        // mul      v15.8h, v24.8h, v1.h[4]           // ...............................~............................'..........................................*............................'..........................................~...........................
        // mls      v15.8h, v27.8h,      v7.h[0]      // .................................~..........................'............................................*..........................'............................................~.........................
        // sub v24.8h,   v8.8h, v10.8h                // .....................................e......................'................................................~......................'................................................~.....................
        // add v8.8h, v8.8h, v10.8h                   // ..........................................................e.'.....................................................................~.'......................................................................
        // sqrdmulh v27.8h,      v24.8h, v0.h[3]      // ...................................~........................'..............................................*........................'..............................................~.......................
        // mul      v10.8h, v24.8h, v0.h[2]           // .....................................~......................'................................................*......................'................................................~.....................
        // mls      v10.8h, v27.8h,      v7.h[0]      // .........................................~..................'....................................................*..................'....................................................~.................
        // sub v24.8h,   v9.8h, v11.8h                // ..................~.........................................'.............................*.........................................'.............................~........................................
        // add v9.8h, v9.8h, v11.8h                   // .......................~....................................'..................................*....................................'..................................~...................................
        // sqrdmulh v27.8h,      v24.8h, v0.h[3]      // .......................~....................................'..................................*....................................'..................................~...................................
        // mul      v11.8h, v24.8h, v0.h[2]           // .....................~......................................'................................*......................................'................................~.....................................
        // mls      v11.8h, v27.8h,      v7.h[0]      // .................................................~..........'............................................................*..........'............................................................~.........
        // sub v24.8h,   v12.8h, v14.8h               // ............................................................'.......*...............................................................'.......~..............................................................
        // add v12.8h, v12.8h, v14.8h                 // ............................................................'........*..............................................................'........~.............................................................
        // sqrdmulh v27.8h,      v24.8h, v0.h[5]      // .........~..................................................'....................*..................................................'....................~.................................................
        // mul      v14.8h, v24.8h, v0.h[4]           // ...........~................................................'......................*................................................'......................~...............................................
        // mls      v14.8h, v27.8h,      v7.h[0]      // .................~..........................................'............................*..........................................'............................~.........................................
        // sub v24.8h,   v13.8h, v15.8h               // .........................................~..................'....................................................*..................'....................................................~.................
        // add v13.8h, v13.8h, v15.8h                 // ......................................~.....................'.................................................*.....................'.................................................~....................
        // sqrdmulh v27.8h,      v24.8h, v0.h[5]      // .............................................~..............'........................................................*..............'........................................................~.............
        // mul      v15.8h, v24.8h, v0.h[4]           // ...............................................~............'..........................................................*............'..........................................................~...........
        // mls      v15.8h, v27.8h,      v7.h[0]      // ...................................................~........'..............................................................*........'..............................................................~.......
        // sub v24.8h,   v8.8h, v12.8h                // ............................................................'..........*............................................................'..........~...........................................................
        // add v8.8h, v8.8h, v12.8h                   // ...............................~............................'..........................................*............................'..........................................~...........................
        // sqrdmulh v27.8h,      v24.8h, v0.h[1]      // ...~........................................................'..............*........................................................'..............~.......................................................
        // mul      v12.8h, v24.8h, v0.h[0]           // .~..........................................................'............*..........................................................'............~.........................................................
        // mls      v12.8h, v27.8h,      v7.h[0]      // ...........................................~................'......................................................*................'......................................................~...............
        // sub v24.8h,   v9.8h, v13.8h                // ................................................~...........'...........................................................*...........'...........................................................~..........
        // add v9.8h, v9.8h, v13.8h                   // ............................................................'......~................................................................'......l...............................................................
        // sqrdmulh v27.8h,      v24.8h, v0.h[1]      // .......................................................~....'..................................................................*....'..................................................................~...
        // mul      v13.8h, v24.8h, v0.h[0]           // .......................................~....................'..................................................~....................'..................................................l...................
        // mls      v13.8h, v27.8h,      v7.h[0]      // .....................................................~......'................................................................~......'................................................................l.....
        // sub v24.8h,   v10.8h, v14.8h               // ..............................................~.............'.........................................................*.............'.........................................................~............
        // add v10.8h, v10.8h, v14.8h                 // ...............................................~............'..........................................................*............'..........................................................~...........
        // sqrdmulh v27.8h,      v24.8h, v0.h[1]      // .........................................................~..'....................................................................*..'....................................................................~.
        // mul      v14.8h, v24.8h, v0.h[0]           // ............................................................'~......................................................................'l.....................................................................
        // mls      v14.8h, v27.8h,      v7.h[0]      // ...........................~................................'......................................~................................'......................................l...............................
        // sub v24.8h,   v11.8h, v15.8h               // ........................................................~...'...................................................................*...'...................................................................~..
        // add v11.8h, v11.8h, v15.8h                 // .........................................................~..'....................................................................*..'....................................................................~.
        // sqrdmulh v27.8h,      v24.8h, v0.h[1]      // ...........................................................~'......................................................................*'......................................................................
        // mul      v15.8h, v24.8h, v0.h[0]           // ............................................................'......~................................................................'......l...............................................................
        // mls      v15.8h, v27.8h,      v7.h[0]      // ............................................................'..........~............................................................'..........l...........................................................
        // str q12, [x0, #(4*(512/8))]                // ............................................................'...~...................................................................'...l..................................................................
        // str q13, [x0, #(5*(512/8))]                // ..........................................................~.'.....................................................................~.'.....................................................................l
        // str q14, [x0, #(6*(512/8))]                // ................................~...........................'...........................................~...........................'...........................................l..........................
        // str q15, [x0, #(7*(512/8))]                // ....~.......................................................'...............~.......................................................'...............l......................................................
        // str q8, [x0], #(16)                        // .................................~..........................'............................................*..........................'............................................~.........................
        // str q9, [x0, #(-16 + 1*(512/8))]           // ............................................................'.........~.............................................................'.........l............................................................
        // str q10, [x0, #(-16 + 2*(512/8))]          // .................................................~..........'............................................................*..........'............................................................~.........
        // str q11, [x0, #(-16 + 3*(512/8))]          // ............................................................~.......................................................................l......................................................................

        subs count, count, 1
        cbnz count, intt_layer123_start
                                                // Instructions:    78
                                                // Expected cycles: 88
                                                // Expected IPC:    0.89
                                                //
                                                // Cycle bound:     88.0
                                                // IPC bound:       0.89
                                                //
                                                // Wall time:     2.54s
                                                // User time:     2.54s
                                                //
                                                // ---------------------------------- cycle (expected) ----------------------------------->
                                                // 0                        25                       50                       75
                                                // |------------------------|------------------------|------------------------|------------
        mul v5.8H, v5.8H, v0.H[0]               // *.......................................................................................
        add v25.8H, v25.8H, v31.8H              // *.......................................................................................
        sub v21.8H, v3.8H, v12.8H               // .*......................................................................................
        str q28, [x0, #176]                     // .*......................................................................................
        mul v4.8H, v2.8H, v0.H[0]               // ..*.....................................................................................
        sub v6.8H, v19.8H, v17.8H               // ..*.....................................................................................
        str q8, [x0, #240]                      // ...*....................................................................................
        add v12.8H, v20.8H, v24.8H              // ...*....................................................................................
        sub v2.8H, v20.8H, v24.8H               // ....*...................................................................................
        mul v8.8H, v15.8H, v0.H[2]              // ....*...................................................................................
        str q25, [x0, #48]                      // .....*..................................................................................
        ldr q23, [x0, #320]                     // .....*..................................................................................
        sqrdmulh v28.8H, v15.8H, v0.H[3]        // ......*.................................................................................
        mls v4.8H, v10.8H, v7.H[0]              // ........*...............................................................................
        add v17.8H, v30.8H, v23.8H              // .........*..............................................................................
        mls v5.8H, v27.8H, v7.H[0]              // ..........*.............................................................................
        sub v9.8H, v30.8H, v23.8H               // ..........*.............................................................................
        add v11.8H, v17.8H, v12.8H              // ...........*............................................................................
        mul v13.8H, v16.8H, v0.H[0]             // ............*...........................................................................
        sub v10.8H, v17.8H, v12.8H              // ............*...........................................................................
        str q4, [x0, #368]                      // .............*..........................................................................
        sub v4.8H, v18.8H, v11.8H               // .............*..........................................................................
        mls v13.8H, v29.8H, v7.H[0]             // ..............*.........................................................................
        add v20.8H, v18.8H, v11.8H              // ..............*.........................................................................
        str q5, [x0, #304]                      // ...............*........................................................................
        str q20, [x0], #(16)                    // ................*.......................................................................
        sqrdmulh v18.8H, v21.8H, v1.H[1]        // ................*.......................................................................
        mul v19.8H, v21.8H, v1.H[0]             // ..................*.....................................................................
        str q13, [x0, #416]                     // ...................*....................................................................
        mul v24.8H, v6.8H, v0.H[6]              // ....................*...................................................................
        sqrdmulh v15.8H, v6.8H, v0.H[7]         // ......................*.................................................................
        mls v8.8H, v28.8H, v7.H[0]              // ........................*...............................................................
        mul v17.8H, v2.8H, v1.H[4]              // ..........................*.............................................................
        sqrdmulh v5.8H, v2.8H, v1.H[5]          // ............................*...........................................................
        mul v22.8H, v9.8H, v1.H[2]              // ..............................*.........................................................
        sqrdmulh v9.8H, v9.8H, v1.H[3]          // ................................*.......................................................
        mls v17.8H, v5.8H, v7.H[0]              // ..................................*.....................................................
        sqrdmulh v21.8H, v10.8H, v0.H[5]        // ....................................*...................................................
        mls v19.8H, v18.8H, v7.H[0]             // ......................................*.................................................
        mul v11.8H, v10.8H, v0.H[4]             // ........................................*...............................................
        mls v24.8H, v15.8H, v7.H[0]             // ..........................................*.............................................
        sqrdmulh v28.8H, v4.8H, v0.H[1]         // ............................................*...........................................
        mul v27.8H, v4.8H, v0.H[0]              // ..............................................*.........................................
        sub v18.8H, v24.8H, v19.8H              // ...............................................*........................................
        add v29.8H, v24.8H, v19.8H              // ................................................*.......................................
        mls v22.8H, v9.8H, v7.H[0]              // ................................................*.......................................
        mls v27.8H, v28.8H, v7.H[0]             // ..................................................*.....................................
        mls v11.8H, v21.8H, v7.H[0]             // ....................................................*...................................
        add v13.8H, v22.8H, v17.8H              // .....................................................*..................................
        sqrdmulh v20.8H, v18.8H, v0.H[3]        // ......................................................*.................................
        sub v26.8H, v22.8H, v17.8H              // .......................................................*................................
        mul v31.8H, v18.8H, v0.H[2]             // ........................................................*...............................
        sub v23.8H, v29.8H, v13.8H              // ........................................................*...............................
        add v29.8H, v29.8H, v13.8H              // .........................................................*..............................
        str q27, [x0, #240]                     // .........................................................*..............................
        sqrdmulh v2.8H, v26.8H, v0.H[5]         // ..........................................................*.............................
        sub v14.8H, v8.8H, v11.8H               // ..........................................................*.............................
        str q29, [x0, #48]                      // ...........................................................*............................
        add v5.8H, v8.8H, v11.8H                // ...........................................................*............................
        mls v31.8H, v20.8H, v7.H[0]             // ............................................................*...........................
        str q5, [x0, #112]                      // .............................................................*..........................
        mul v15.8H, v23.8H, v0.H[0]             // ..............................................................*.........................
        mul v5.8H, v26.8H, v0.H[4]              // ................................................................*.......................
        mls v5.8H, v2.8H, v7.H[0]               // ..................................................................*.....................
        sqrdmulh v8.8H, v14.8H, v0.H[1]         // ....................................................................*...................
        sqrdmulh v18.8H, v23.8H, v0.H[1]        // ......................................................................*.................
        sub v11.8H, v31.8H, v5.8H               // .......................................................................*................
        mul v29.8H, v14.8H, v0.H[0]             // ........................................................................*...............
        sqrdmulh v3.8H, v11.8H, v0.H[1]         // ..........................................................................*.............
        add v23.8H, v31.8H, v5.8H               // ............................................................................*...........
        mls v15.8H, v18.8H, v7.H[0]             // ............................................................................*...........
        str q23, [x0, #176]                     // ..............................................................................*.........
        mls v29.8H, v8.8H, v7.H[0]              // ..............................................................................*.........
        mul v25.8H, v11.8H, v0.H[0]             // ................................................................................*.......
        str q15, [x0, #304]                     // .................................................................................*......
        mls v25.8H, v3.8H, v7.H[0]              // ..................................................................................*.....
        str q29, [x0, #368]                     // ...................................................................................*....
        str q25, [x0, #432]                     // .......................................................................................*

                                                 // ---------------------------------- cycle (expected) ----------------------------------->
                                                 // 0                        25                       50                       75
                                                 // |------------------------|------------------------|------------------------|------------
        // sub v6.8H, v19.8H, v17.8H             // ..*.....................................................................................
        // str q28, [x0, #176]                   // .*......................................................................................
        // ldr q22, [x0, #320]                   // .....*..................................................................................
        // mul v23.8H, v2.8H, v0.H[0]            // ..*.....................................................................................
        // sqrdmulh v11.8H, v6.8H, v0.H[7]       // ......................*.................................................................
        // str q8, [x0, #240]                    // ...*....................................................................................
        // add v13.8H, v20.8H, v24.8H            // ...*....................................................................................
        // mul v26.8H, v6.8H, v0.H[6]            // ....................*...................................................................
        // add v4.8H, v30.8H, v22.8H             // .........*..............................................................................
        // add v6.8H, v25.8H, v31.8H             // *.......................................................................................
        // mul v14.8H, v16.8H, v0.H[0]           // ............*...........................................................................
        // sub v31.8H, v4.8H, v13.8H             // ............*...........................................................................
        // mls v26.8H, v11.8H, v7.H[0]           // ..........................................*.............................................
        // add v13.8H, v4.8H, v13.8H             // ...........*............................................................................
        // str q6, [x0, #48]                     // .....*..................................................................................
        // mls v14.8H, v29.8H, v7.H[0]           // ..............*.........................................................................
        // sub v28.8H, v18.8H, v13.8H            // .............*..........................................................................
        // sub v29.8H, v30.8H, v22.8H            // ..........*.............................................................................
        // mul v8.8H, v28.8H, v0.H[0]            // ..............................................*.........................................
        // sub v3.8H, v3.8H, v12.8H              // .*......................................................................................
        // sqrdmulh v21.8H, v28.8H, v0.H[1]      // ............................................*...........................................
        // str q14, [x0, #432]                   // ...................*....................................................................
        // sub v14.8H, v20.8H, v24.8H            // ....*...................................................................................
        // mul v16.8H, v3.8H, v1.H[0]            // ..................*.....................................................................
        // sqrdmulh v9.8H, v3.8H, v1.H[1]        // ................*.......................................................................
        // sqrdmulh v4.8H, v31.8H, v0.H[5]       // ....................................*...................................................
        // mul v11.8H, v31.8H, v0.H[4]           // ........................................*...............................................
        // mls v16.8H, v9.8H, v7.H[0]            // ......................................*.................................................
        // sqrdmulh v19.8H, v29.8H, v1.H[3]      // ................................*.......................................................
        // mls v11.8H, v4.8H, v7.H[0]            // ....................................................*...................................
        // sub v22.8H, v26.8H, v16.8H            // ...............................................*........................................
        // sqrdmulh v6.8H, v14.8H, v1.H[5]       // ............................*...........................................................
        // mul v4.8H, v22.8H, v0.H[2]            // ........................................................*...............................
        // add v25.8H, v26.8H, v16.8H            // ................................................*.......................................
        // sqrdmulh v28.8H, v22.8H, v0.H[3]      // ......................................................*.................................
        // mul v22.8H, v29.8H, v1.H[2]           // ..............................*.........................................................
        // mls v23.8H, v10.8H, v7.H[0]           // ........*...............................................................................
        // mls v22.8H, v19.8H, v7.H[0]           // ................................................*.......................................
        // mul v29.8H, v14.8H, v1.H[4]           // ..........................*.............................................................
        // add v14.8H, v18.8H, v13.8H            // ..............*.........................................................................
        // str q23, [x0, #368]                   // .............*..........................................................................
        // mls v29.8H, v6.8H, v7.H[0]            // ..................................*.....................................................
        // str q14, [x0], #(16)                  // ................*.......................................................................
        // sqrdmulh v13.8H, v15.8H, v0.H[3]      // ......*.................................................................................
        // mul v23.8H, v15.8H, v0.H[2]           // ....*...................................................................................
        // add v31.8H, v22.8H, v29.8H            // .....................................................*..................................
        // mul v18.8H, v5.8H, v0.H[0]            // *.......................................................................................
        // mls v23.8H, v13.8H, v7.H[0]           // ........................*...............................................................
        // sub v13.8H, v22.8H, v29.8H            // .......................................................*................................
        // mls v8.8H, v21.8H, v7.H[0]            // ..................................................*.....................................
        // sqrdmulh v22.8H, v13.8H, v0.H[5]      // ..........................................................*.............................
        // sub v2.8H, v23.8H, v11.8H             // ..........................................................*.............................
        // add v16.8H, v23.8H, v11.8H            // ...........................................................*............................
        // mul v23.8H, v13.8H, v0.H[4]           // ................................................................*.......................
        // sub v5.8H, v25.8H, v31.8H             // ........................................................*...............................
        // mls v4.8H, v28.8H, v7.H[0]            // ............................................................*...........................
        // str q16, [x0, #112]                   // .............................................................*..........................
        // mls v23.8H, v22.8H, v7.H[0]           // ..................................................................*.....................
        // mls v18.8H, v27.8H, v7.H[0]           // ..........*.............................................................................
        // sqrdmulh v27.8H, v5.8H, v0.H[1]       // ......................................................................*.................
        // sub v16.8H, v4.8H, v23.8H             // .......................................................................*................
        // add v28.8H, v4.8H, v23.8H             // ............................................................................*...........
        // sqrdmulh v10.8H, v2.8H, v0.H[1]       // ....................................................................*...................
        // str q18, [x0, #288]                   // ...............*........................................................................
        // sqrdmulh v29.8H, v16.8H, v0.H[1]      // ..........................................................................*.............
        // str q28, [x0, #176]                   // ..............................................................................*.........
        // mul v23.8H, v2.8H, v0.H[0]            // ........................................................................*...............
        // str q8, [x0, #240]                    // .........................................................*..............................
        // add v6.8H, v25.8H, v31.8H             // .........................................................*..............................
        // mul v14.8H, v16.8H, v0.H[0]           // ................................................................................*.......
        // str q6, [x0, #48]                     // ...........................................................*............................
        // mls v14.8H, v29.8H, v7.H[0]           // ..................................................................................*.....
        // str q14, [x0, #432]                   // .......................................................................................*
        // mls v23.8H, v10.8H, v7.H[0]           // ..............................................................................*.........
        // str q23, [x0, #368]                   // ...................................................................................*....
        // mul v18.8H, v5.8H, v0.H[0]            // ..............................................................*.........................
        // mls v18.8H, v27.8H, v7.H[0]           // ............................................................................*...........
        // str q18, [x0, #304]                   // .................................................................................*......


        pop_stack
        ret

/****************** REGISTER DEALLOCATIONS *******************/
    .unreq in
    .unreq r12345_ptr
    .unreq r67_ptr
    .unreq inp
    .unreq count
    .unreq wtmp
    .unreq data0
    .unreq data1
    .unreq data2
    .unreq data3
    .unreq data4
    .unreq data5
    .unreq data6
    .unreq data7
    .unreq q_data0
    .unreq q_data1
    .unreq q_data2
    .unreq q_data3
    .unreq q_data4
    .unreq q_data5
    .unreq q_data6
    .unreq q_data7
    .unreq root0
    .unreq root1
    .unreq root2
    .unreq root0_tw
    .unreq root1_tw
    .unreq root2_tw
    .unreq consts
    .unreq q_consts
    .unreq q_root0
    .unreq q_root1
    .unreq q_root2
    .unreq q_root0_tw
    .unreq q_root1_tw
    .unreq q_root2_tw
    .unreq tmp
    .unreq t0
    .unreq t1
    .unreq t2
    .unreq t3
    .unreq ninv
    .unreq ninv_tw

/* simpasm: footer-start */
#endif /* MLK_ARITH_BACKEND_AARCH64 && !MLK_CONFIG_MULTILEVEL_NO_SHARED */
